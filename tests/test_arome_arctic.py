"""Test arome arctic"""
import os
import logging
import datetime
import xarray as xr
import numpy as np
import pandas as pd
from unittest.mock import patch, MagicMock
from mapgen.modules.get_quicklook import get_quicklook

def _create_arome_arctic_dataset_from_orig_data():
    """Create a simple dataset for testing"""
    ds = xr.open_dataset("/lustre/storeB/project/metproduction/products/arome_arctic/arome_arctic_det_vdiv_2_5km_20241111T06Z.nc")
    ds = ds.isel(time=[0,1], x=[0,1,2,3,4,5,6,7,8,9], y=[0,1,2,3,4,5,6,7,8,9,10,11,12], pressure=[0,1], height5=[0,1])
    print(list(ds.keys()))
    remove_variables = ['land_area_fraction', 'surface_aerosol_sea', 'surface_aerosol_land', 'surface_aerosol_soot', 'surface_aerosol_desert', 'ozone_profile_a', 'ozone_profile_b', 'ozone_profile_c', 'graupelfall_amount', 'toa_net_downward_shortwave_flux', 'surface_downwelling_shortwave_flux_in_air', 'toa_outgoing_longwave_flux', 'surface_downwelling_longwave_flux_in_air', 'convective_cloud_area_fraction', 'hail_diagnostic', 'cloud_binary_mask', 'atmosphere_level_of_max_icing', 'atmosphere_level_of_max_icing_growth', 'atmosphere_level_of_icing_bottom', 'atmosphere_level_of_icing_top', 'atmosphere_level_of_max_wind_speed', 'x_wind_at_maximum_wind_speed_level', 'y_wind_at_maximum_wind_speed_level',
                        'cloud_base_altitude', 'cloud_top_altitude', 'cloud_base_altitude_z', 'lightning_index', 'level_of_max_CAT_index', 'max_cat_index', 'bottom_level_of_CAT', 'top_level_of_CAT', 'visibility_in_air', 'precipitation_type', 'brunt_vaisala_frequency_in_air', 'integral_of_surface_downward_latent_heat_flux_wrt_time', 'integral_of_surface_net_downward_longwave_flux_wrt_time_assuming_clear_sky', 'integral_of_surface_net_downward_shortwave_flux_wrt_time_assuming_clear_sky', 'integral_of_surface_parallel_solar_flux_wrt_time', 'integral_of_toa_net_downward_longwave_flux_wrt_time_assuming_clear_sky', 'integral_of_toa_net_downward_shortwave_flux_wrt_time_assuming_clear_sky',
                        'integral_of_toa_downwelling_shortwave_flux_wrt_time', 'integral_of_surface_direct_normal_irradiance_wrt_time', 'icing_index', 'liquid_water_content_of_surface_snow', 'altitude_of_0_degree_isotherm', 'integral_of_surface_net_downward_shortwave_flux_wrt_time', 'integral_of_surface_net_downward_longwave_flux_wrt_time', 'integral_of_surface_downward_latent_heat_evaporation_flux_wrt_time', 'integral_of_surface_downward_latent_heat_sublimation_flux_wrt_time', 'integral_of_surface_downward_sensible_heat_flux_wrt_time', 'downward_eastward_momentum_flux_in_air', 'specific_humidity_pl', 'downward_northward_momentum_flux_in_air', 'integral_of_toa_net_downward_shortwave_flux_wrt_time',
                        'mass_fraction_of_cloud_condensed_water_in_air_pl', 'integral_of_toa_outgoing_longwave_flux_wrt_time', 'water_evaporation_amount', 'surface_snow_sublimation_amount_acc', 'mass_fraction_of_cloud_ice_in_air_pl', 'relative_humidity_z', 'integral_of_surface_downwelling_shortwave_flux_in_air_wrt_time', 'integral_of_surface_downwelling_longwave_flux_in_air_wrt_time', 'cloud_area_fraction_pl', 'integral_of_rainfall_amount_wrt_time', 'integral_of_snowfall_amount_wrt_time', 'mass_fraction_of_snow_in_air_pl', 'integral_of_graupelfall_amount_wrt_time', 'mass_fraction_of_rain_in_air_pl', 'tropopause_air_temperature', 'altitude_of_0_degree_isotherm_from_above', 'specific_humidity_2m',
                        'mass_fraction_of_graupel_in_air_pl', 'tropopause_air_pressure', 'cloud_area_fraction', 'turbulent_kinetic_energy_pl', 'altitude_of_isoTprimW_equal_0', 'high_type_cloud_area_fraction', 'medium_type_cloud_area_fraction', 'geopotential_pl', 'low_type_cloud_area_fraction', 'x_wind_gust_10m', 'relative_humidity_pl', 'y_wind_gust_10m', 'air_temperature_max', 'upward_air_velocity_pl', 'lifting_condensation_level', 'air_temperature_min', 'atmosphere_boundary_layer_thickness', 'ertel_potential_vorticity_pl', 'atmosphere_level_of_free_convection', 'rainfall_amount', 'snowfall_amount', 'lwe_thickness_of_atmosphere_mass_content_of_water_vapor', 'atmosphere_level_of_neutral_buoyancy',
                        'precipitation_amount_acc', 'snowfall_amount_acc', 'wind_speed_of_gust', 'fog_area_fraction', 'SFX_TICE_01', 'SFX_TICE_02', 'SFX_TICE_03', 'SFX_TICE_04', 'SFX_ICE_THK', 'SFX_SIC', 'SFX_SST', 'SFX_TS_WATER', 'SFX_T_SNOW', 'SFX_T_ICE', 'SFX_T_MNW', 'SFX_T_WML', 'SFX_T_BOT', 'SFX_H_SNOW', 'SFX_H_ICE', 'SFX_H_ML', 'SFX_X001TG1', 'SFX_X002TG1', 'SFX_X001TG2', 'SFX_X002TG2', 'SFX_X001WG1', 'SFX_X002WG1', 'SFX_X001WG2', 'SFX_X002WG2', 'SFX_X001WGI1', 'SFX_X002WGI1', 'SFX_X001WGI2', 'SFX_X002WGI2', 'SFX_X001WSN_VEG1', 'SFX_X002WSN_VEG1', 'SFX_X001RSN_VEG1', 'SFX_X002RSN_VEG1', 'SFX_X001ASN_VEG', 'SFX_X002ASN_VEG', 'SFX_WS_ROAD', 'SFX_T2M_SEA', 'SFX_Q2M_SEA', 'SFX_HU2M_SEA',
                        'SFX_ZON10M_SEA', 'SFX_MER10M_SEA', 'SFX_DSN_T_ICE', 'SFX_T2M_WAT', 'SFX_Q2M_WAT', 'SFX_HU2M_WAT', 'SFX_ZON10M_WAT', 'SFX_MER10M_WAT', 'SFX_TALB_ISBA', 'SFX_T2M_ISBA', 'SFX_Q2M_ISBA', 'SFX_HU2M_ISBA', 'SFX_ZON10M_ISBA', 'SFX_MER10M_ISBA', 'SFX_X001T2M_P', 'SFX_X002T2M_P', 'SFX_X001Q2M_P', 'SFX_X002Q2M_P', 'SFX_X001HU2M_P', 'SFX_X002HU2M_P', 'SFX_X001ZON10M_P', 'SFX_X001MER10M_P', 'SFX_X002ZON10M_P', 'SFX_X002MER10M_P', 'SFX_RNC_ISBA', 'SFX_HC_ISBA', 'SFX_LEC_ISBA', 'SFX_FMUC_ISBA', 'SFX_FMVC_ISBA', 'SFX_PSNG_ISBA', 'SFX_PSNV_ISBA', 'SFX_PSN_ISBA', 'SFX_WSN_T_ISBA', 'SFX_DSN_T_ISBA', 'SFX_X001LAI', 'SFX_X002LAI', 'SFX_X001VEG', 'SFX_X002VEG', 'SFX_T2M_TEB', 'SFX_Q2M_TEB',
                        'SFX_HU2M_TEB', 'SFX_ZON10M_TEB', 'SFX_MER10M_TEB', 'SFX_RI', 'SFX_TS', 'SFX_EMIS', 'SFX_T2M', 'SFX_Q2M', 'SFX_HU2M', 'SFX_ZON10M', 'SFX_MER10M', 'SFX_RN', 'SFX_H', 'SFX_LE', 'SFX_GFLUX', 'SFX_FMU', 'SFX_FMV', 'SFX_CD', 'SFX_CH', 'SFX_CE', 'SFX_Z0', 'SFX_Z0H']
    ds_trimmed = ds.drop_vars(remove_variables)    
    ds_trimmed.to_netcdf("test_arome_arctic.nc")

def _create_arome_arctic_dataset_from_orig_data_without_reference_time():
    """Create a simple dataset for testing"""
    ds = xr.open_dataset("tests/data/test_arome_arctic.nc")  # arome_arctic_det_vdiv_2_5km_20241111T06Z.nc
    ds_trimmed = ds.drop_vars(['forecast_reference_time'])    
    ds_trimmed.to_netcdf("test_arome_arctic_without_forecast_time_20241111T06Z.nc")

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
@patch('mapgen.modules.helpers._find_summary_from_csw')
def test_read_dataset(mock_csw, mock_read_config, tmpdir, caplog):
    """Test reading the dataset"""
    netcdf_path = "tests/data/test_arome_arctic.nc"
    query_string = ""
    http_host = "localhost"
    url_scheme = "http"
    mock_csw.return_value = "TEST_CSW"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
                                 'base_netcdf_directory': '.',
                                 'module': 'mapgen.modules.arome_arctic_quicklook',
                                 'module_function': 'arome_arctic_quicklook',
                                 'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                 'map_file_bucket': 'test-map-bucket',
                                 'geotiff_bucket': 'test_bucket',
                                 'mapfiles_path': tmpdir,
                                 'geotiff_tmp': tmpdir,
                                 'default_dataset': 'presure'}, None, None, None

    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '200 OK'
    expected_result = b'<?xml version="1.0" ?><WMS_Capabilities xmlns="http://www.opengis.net/wms" xmlns:sld="http://www.opengis.net/sld" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ms="http://mapserver.gis.umn.edu/mapserver" version="1.3.0" xsi:schemaLocation="http://www.opengis.net/wms http://schemas.opengis.net/wms/1.3.0/capabilities_1_3_0.xsd  http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/sld_capabilities.xsd  http://mapserver.gis.umn.edu/mapserver http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?service=WMS&amp;version=1.3.0&amp;request=GetSchemaExtension">\n<Service>\n  <Name>WMS</Name>\n  <Title>WMS Arome Arctic</Title>\n  <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/>\n  <ContactInformation>\n  </ContactInformation>\n  <MaxWidth>4096</MaxWidth>\n  <MaxHeight>4096</MaxHeight>\n</Service>\n\n<Capability>\n  <Request>\n    <GetCapabilities>\n      <Format>text/xml</Format>\n      <DCPType>\n        <HTTP>\n          <Get><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Get>\n          <Post><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Post>\n        </HTTP>\n      </DCPType>\n    </GetCapabilities>\n    <GetMap>\n      <Format>image/png</Format>\n      <Format>image/jpeg</Format>\n      <Format>image/png; mode=8bit</Format>\n      <Format>image/vnd.jpeg-png</Format>\n      <Format>image/vnd.jpeg-png8</Format>\n      <Format>application/x-pdf</Format>\n      <Format>image/svg+xml</Format>\n      <Format>image/tiff</Format>\n      <Format>application/vnd.mapbox-vector-tile</Format>\n      <Format>application/x-protobuf</Format>\n      <Format>application/json</Format>\n      <DCPType>\n        <HTTP>\n          <Get><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Get>\n          <Post><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Post>\n        </HTTP>\n      </DCPType>\n    </GetMap>\n    <GetFeatureInfo>\n      <Format>text/plain</Format>\n      <Format>application/vnd.ogc.gml</Format>\n      <DCPType>\n        <HTTP>\n          <Get><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Get>\n          <Post><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Post>\n        </HTTP>\n      </DCPType>\n    </GetFeatureInfo>\n    <sld:DescribeLayer>\n      <Format>text/xml</Format>\n      <DCPType>\n        <HTTP>\n          <Get><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Get>\n          <Post><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Post>\n        </HTTP>\n      </DCPType>\n    </sld:DescribeLayer>\n    <sld:GetLegendGraphic>\n      <Format>image/png</Format>\n      <Format>image/jpeg</Format>\n      <Format>image/png; mode=8bit</Format>\n      <Format>image/vnd.jpeg-png</Format>\n      <Format>image/vnd.jpeg-png8</Format>\n      <DCPType>\n        <HTTP>\n          <Get><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Get>\n          <Post><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Post>\n        </HTTP>\n      </DCPType>\n    </sld:GetLegendGraphic>\n    <ms:GetStyles>\n      <Format>text/xml</Format>\n      <DCPType>\n        <HTTP>\n          <Get><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Get>\n          <Post><OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?"/></Post>\n        </HTTP>\n      </DCPType>\n    </ms:GetStyles>\n  </Request>\n  <Exception>\n    <Format>XML</Format>\n    <Format>INIMAGE</Format>\n    <Format>BLANK</Format>\n  </Exception>\n  <sld:UserDefinedSymbolization SupportSLD="1" UserLayer="0" UserStyle="1" RemoteWFS="0" InlineFeature="0" RemoteWCS="0"/>\n  <Layer>\n    <Name>MS</Name>\n    <Title>WMS Arome Arctic</Title>\n    <Abstract>MS</Abstract>\n    <CRS>EPSG:3857</CRS>\n    <CRS>EPSG:3978</CRS>\n    <CRS>EPSG:4269</CRS>\n    <CRS>EPSG:4326</CRS>\n    <CRS>EPSG:25832</CRS>\n    <CRS>EPSG:25833</CRS>\n    <CRS>EPSG:25835</CRS>\n    <CRS>EPSG:32632</CRS>\n    <CRS>EPSG:32633</CRS>\n    <CRS>EPSG:32635</CRS>\n    <CRS>EPSG:32661</CRS>\n    <CRS>EPSG:3575</CRS>\n    <EX_GeographicBoundingBox>\n        <westBoundLongitude>-18.000000</westBoundLongitude>\n        <eastBoundLongitude>80.000000</eastBoundLongitude>\n        <southBoundLatitude>62.000000</southBoundLatitude>\n        <northBoundLatitude>88.000000</northBoundLatitude>\n    </EX_GeographicBoundingBox>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>air_temperature_0m</Name>\n        <Title>air_temperature_0m: Surface temperature (T0M)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=air_temperature_0m"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_0m&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_0m&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>surface_geopotential</Name>\n        <Title>surface_geopotential: Surface geopotential (fis)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=surface_geopotential"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=surface_geopotential&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=surface_geopotential&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>x_wind_pl</Name>\n        <Title>x_wind_pl: Wind along x-coordinate on pressure levels</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="pressure" units="hPa" default="100.0" multipleValues="1" nearestValue="0">50.0,100.0</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=x_wind_pl"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=x_wind_pl&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=x_wind_pl&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>wind_pl_vector</Name>\n        <Title>wind_pl vector from x_wind_pl and y_wind_pl component</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="pressure" units="hPa" default="100.0" multipleValues="1" nearestValue="0">50.0,100.0</Dimension>\n        <Dimension name="Spacing" units="pixels" default="12" multipleValues="1" nearestValue="0">2,4,8,12,16,24,32</Dimension>\n        <Dimension name="Colour" units="" default="light-green" multipleValues="1" nearestValue="0">blue,red,green,cyan,magenta,yellow,light-green</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=wind_pl_vector"/>\n        </MetadataURL>\n        <Style>\n          <Name>Vector</Name>\n          <Title>Vector</Title>\n          <LegendURL width="104" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_pl_vector&amp;format=image/png&amp;STYLE=Vector"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>Wind_Barbs</Name>\n          <Title>Wind_Barbs</Title>\n          <LegendURL width="104" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_pl_vector&amp;format=image/png&amp;STYLE=Wind_Barbs"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>x_wind_z</Name>\n        <Title>x_wind_z: Wind along x-coordinate on height levels</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="height2" units="m" default="120.0" multipleValues="1" nearestValue="0">80.0,120.0</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=x_wind_z"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=x_wind_z&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=x_wind_z&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>wind_z_vector</Name>\n        <Title>wind_z vector from x_wind_z and y_wind_z component</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="height2" units="m" default="120.0" multipleValues="1" nearestValue="0">80.0,120.0</Dimension>\n        <Dimension name="Spacing" units="pixels" default="12" multipleValues="1" nearestValue="0">2,4,8,12,16,24,32</Dimension>\n        <Dimension name="Colour" units="" default="light-green" multipleValues="1" nearestValue="0">blue,red,green,cyan,magenta,yellow,light-green</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=wind_z_vector"/>\n        </MetadataURL>\n        <Style>\n          <Name>Vector</Name>\n          <Title>Vector</Title>\n          <LegendURL width="104" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_z_vector&amp;format=image/png&amp;STYLE=Vector"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>Wind_Barbs</Name>\n          <Title>Wind_Barbs</Title>\n          <LegendURL width="104" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_z_vector&amp;format=image/png&amp;STYLE=Wind_Barbs"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>y_wind_pl</Name>\n        <Title>y_wind_pl: Wind along y-coordinate on pressure levels</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="pressure" units="hPa" default="100.0" multipleValues="1" nearestValue="0">50.0,100.0</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=y_wind_pl"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=y_wind_pl&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=y_wind_pl&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>y_wind_z</Name>\n        <Title>y_wind_z: Wind along y-coordinate on height levels</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="height2" units="m" default="120.0" multipleValues="1" nearestValue="0">80.0,120.0</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=y_wind_z"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=y_wind_z&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=y_wind_z&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>air_temperature_pl</Name>\n        <Title>air_temperature_pl: Air temperature pressure levels</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="pressure" units="hPa" default="100.0" multipleValues="1" nearestValue="0">50.0,100.0</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=air_temperature_pl"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_pl&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_pl&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>air_temperature_z</Name>\n        <Title>air_temperature_z: Air temperature height levels</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="height2" units="m" default="120.0" multipleValues="1" nearestValue="0">80.0,120.0</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=air_temperature_z"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_z&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_z&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>surface_air_pressure</Name>\n        <Title>surface_air_pressure: Surface air pressure</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=surface_air_pressure"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=surface_air_pressure&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=surface_air_pressure&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>air_temperature_2m</Name>\n        <Title>air_temperature_2m: Screen level temperature (T2M)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=air_temperature_2m"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_2m&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_temperature_2m&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>relative_humidity_2m</Name>\n        <Title>relative_humidity_2m: Screen level relative humidity (RH2M)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=relative_humidity_2m"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=relative_humidity_2m&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=relative_humidity_2m&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>x_wind_10m</Name>\n        <Title>x_wind_10m: 10 metre wind along x-coordinate (U10M)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=x_wind_10m"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=x_wind_10m&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=x_wind_10m&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>wind_10m_vector</Name>\n        <Title>wind_10m vector from x_wind_10m and y_wind_10m component</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <Dimension name="Spacing" units="pixels" default="12" multipleValues="1" nearestValue="0">2,4,8,12,16,24,32</Dimension>\n        <Dimension name="Colour" units="" default="light-green" multipleValues="1" nearestValue="0">blue,red,green,cyan,magenta,yellow,light-green</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=wind_10m_vector"/>\n        </MetadataURL>\n        <Style>\n          <Name>Vector</Name>\n          <Title>Vector</Title>\n          <LegendURL width="104" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_10m_vector&amp;format=image/png&amp;STYLE=Vector"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>Wind_Barbs</Name>\n          <Title>Wind_Barbs</Title>\n          <LegendURL width="104" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_10m_vector&amp;format=image/png&amp;STYLE=Wind_Barbs"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>y_wind_10m</Name>\n        <Title>y_wind_10m: 10 metre wind along y-coordinate (V10M)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=y_wind_10m"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=y_wind_10m&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=y_wind_10m&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>air_pressure_at_sea_level</Name>\n        <Title>air_pressure_at_sea_level: Mean Sea Level Pressure (MSLP)</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=air_pressure_at_sea_level"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_pressure_at_sea_level&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=air_pressure_at_sea_level&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>wind_direction</Name>\n        <Title>wind_direction: Wind direction</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=wind_direction"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_direction&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_direction&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n    <Layer queryable="0" opaque="0" cascaded="0">\n        <Name>wind_speed</Name>\n        <Title>wind_speed: Wind speed</Title>\n        <EX_GeographicBoundingBox>\n            <westBoundLongitude>-17.956718</westBoundLongitude>\n            <eastBoundLongitude>-17.295131</eastBoundLongitude>\n            <southBoundLatitude>69.273533</southBoundLatitude>\n            <northBoundLatitude>69.564065</northBoundLatitude>\n        </EX_GeographicBoundingBox>\n        <Dimension name="time" units="ISO8601" nearestValue="0">2024-11-11T06:00:00Z/2024-11-11T07:00:00Z/PT1H</Dimension>\n        <MetadataURL type="TC211">\n          <Format>text/xml</Format>\n          <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?request=GetMetadata&amp;layer=wind_speed"/>\n        </MetadataURL>\n        <Style>\n          <Name>contour</Name>\n          <Title>contour</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_speed&amp;format=image/png&amp;STYLE=contour"/>\n          </LegendURL>\n        </Style>\n        <Style>\n          <Name>raster</Name>\n          <Title>raster</Title>\n          <LegendURL width="357" height="38">\n             <Format>image/png</Format>\n             <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="http://localhost/api/get_quicklooktests/data/test_arome_arctic.nc?version=1.3.0&amp;service=WMS&amp;request=GetLegendGraphic&amp;sld_version=1.1.0&amp;layer=wind_speed&amp;format=image/png&amp;STYLE=raster"/>\n          </LegendURL>\n        </Style>\n    </Layer>\n  </Layer>\n</Capability>\n</WMS_Capabilities>'
    assert result == expected_result
    assert content_type == "text/xml; charset=UTF-8"

    # Retest the same test to check for existing getcapabilities map file
    caplog.set_level(logging.DEBUG)
    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '200 OK'
    assert "Reuse existing getcapabilities map file" in caplog.text 
    assert content_type == "text/xml; charset=UTF-8"
    tmpdir.remove()

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
@patch('mapgen.modules.helpers._find_summary_from_csw')
def test_get_quicklook_arome_arctic_no_reference_time(mock_csw, mock_read_config, tmpdir, caplog):
    """Test for a none existing netcdf file"""
    netcdf_path = "tests/data/test_arome_arctic_without_forecast_time_20241111T06Z.nc"
    query_string = ""
    http_host = "localhost"
    url_scheme = "http"
    mock_csw.return_value = "TEST CSW"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic_without_forecast_time_(\d{8}T\d{2})Z.nc)$',
                                      'base_netcdf_directory': '.',
                                      'module': 'mapgen.modules.arome_arctic_quicklook',
                                      'module_function': 'arome_arctic_quicklook',
                                      'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                      'map_file_bucket': 'test-map-bucket',
                                      'geotiff_bucket': 'test_bucket',
                                      'mapfiles_path': tmpdir,
                                      'geotiff_tmp': tmpdir,
                                      'default_dataset': 'presure'}, None, None, None

    caplog.set_level(logging.DEBUG)
    response_code, _, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '200 OK'
    assert content_type == "text/xml; charset=UTF-8"
    assert 'Could not find forecast time or analysis time from dataset. Try parse from filename.' in caplog.text
    assert 'Forecast time: 2024-11-11 06:00:00' in caplog.text
    tmpdir.remove()

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
def test_read_dataset_base_path(mock_read_config, tmpdir):
    """Test reading the dataset"""
    netcdf_path = "/tests/data/test_arome_arctic.nc"
    query_string = ""
    http_host = "localhost"
    url_scheme = "http"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
                                 'base_netcdf_directory': '/tests',
                                 'module': 'mapgen.modules.arome_arctic_quicklook',
                                 'module_function': 'arome_arctic_quicklook',
                                 'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                 'map_file_bucket': 'test-map-bucket',
                                 'geotiff_bucket': 'test_bucket',
                                 'mapfiles_path': tmpdir,
                                 'geotiff_tmp': tmpdir,
                                 'default_dataset': 'presure'}, None, None, None

    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '404 Not Found'
    tmpdir.remove()

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
def test_read_dataset_base_path_missing_base(mock_read_config, tmpdir):
    """Test reading the dataset"""
    netcdf_path = "/tests/data/test_arome_arctic.nc"
    query_string = ""
    http_host = "localhost"
    url_scheme = "http"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
                                 #'base_netcdf_directory': '/tests',
                                 'module': 'mapgen.modules.arome_arctic_quicklook',
                                 'module_function': 'arome_arctic_quicklook',
                                 'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                 'map_file_bucket': 'test-map-bucket',
                                 'geotiff_bucket': 'test_bucket',
                                 'mapfiles_path': tmpdir,
                                 'geotiff_tmp': tmpdir,
                                 'default_dataset': 'presure'}, None, None, None

    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '500 Internal Server Error'
    tmpdir.remove()

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
@patch('mapgen.modules.helpers._find_summary_from_csw')
def test_read_dataset_request_getmap(mock_csw, mock_read_config, tmpdir, caplog):
    """Test reading the dataset"""
    netcdf_path = "tests/data/test_arome_arctic.nc"
    query_string = ("?&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=air_temperature_2m&WIDTH=767&HEIGHT=880&CRS=EPSG%3A3857&"
                    "BBOX=-4822584.097826986,7566329.44660393,10215292.880334288,24819695.471091438&STYLES=raster&FORMAT=image/png&"
                    "TRANSPARENT=TRUE&&TIME=2024-11-11T07%3A00%3A00Z")
    http_host = "localhost"
    url_scheme = "http"
    mock_csw.return_value = "TEST CSW"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
                                 'base_netcdf_directory': os.getcwd(),
                                 'module': 'mapgen.modules.arome_arctic_quicklook',
                                 'module_function': 'arome_arctic_quicklook',
                                 'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                 'map_file_bucket': 'test-map-bucket',
                                 'geotiff_bucket': 'test_bucket',
                                 'mapfiles_path': tmpdir,
                                 'geotiff_tmp': tmpdir,
                                 'default_dataset': 'presure'}, None, None, None

    caplog.set_level(logging.DEBUG)
    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '200 OK'
    assert ("QP after flatten lists {'service': 'WMS', 'version': '1.3.0', 'request': 'GetMap', 'layers': 'air_temperature_2m', "
            "'width': '767', 'height': '880', 'crs': 'EPSG:3857', 'bbox': '-4822584.097826986,7566329.44660393,10215292.880334288,24819695.471091438', "
            "'styles': 'raster', 'format': 'image/png', 'transparent': 'TRUE', 'time': '2024-11-11T07:00:00Z'}") in caplog.text
    assert ("Calculate band number from dimension: [{'dim_name': 'time', 'ds_size': 2, 'selected_band_number': 1}, "
            "{'dim_name': 'height1', 'ds_size': 1, 'selected_band_number': 0}]") in caplog.text
    assert "MIN:MAX 274.2896728515625 274.8013916015625" in caplog.text
    assert "REQUEST is: GetMap" in caplog.text
    assert "STYLES: raster" in caplog.text
    assert "STYLE: None" in caplog.text

    tmpdir.remove()

# @patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
# @patch('mapgen.modules.helpers._find_summary_from_csw')
# def test_read_dataset_request_getmap_contour_style(mock_csw, mock_read_config, tmpdir, caplog):
#     """Test reading the dataset"""
#     netcdf_path = "tests/data/test_arome_arctic.nc"
#     query_string = ("?&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=air_temperature_2m&WIDTH=767&HEIGHT=880&CRS=EPSG%3A3857&"
#                     "BBOX=-4822584.097826986,7566329.44660393,10215292.880334288,24819695.471091438&STYLES=contour&FORMAT=image/png&"
#                     "TRANSPARENT=TRUE&&TIME=2024-11-11T07%3A00%3A00Z")
#     http_host = "localhost"
#     url_scheme = "http"
#     mock_csw.return_value = "TEST CSW"
#     mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
#                                  'base_netcdf_directory': '.',
#                                  'module': 'mapgen.modules.arome_arctic_quicklook',
#                                  'module_function': 'arome_arctic_quicklook',
#                                  'mapfile_template': os.path.join(tmpdir, 'test.map'),
#                                  'map_file_bucket': 'test-map-bucket',
#                                  'geotiff_bucket': 'test_bucket',
#                                  'mapfiles_path': tmpdir,
#                                  'geotiff_tmp': tmpdir,
#                                  'default_dataset': 'presure'}, None, None, None

#     caplog.set_level(logging.DEBUG)
#     response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
#     assert response_code == '200 OK'
#     assert "Selected style: contour" in caplog.text
#     assert "Style in contour for style setup." in caplog.text
#     assert "Selected label scale 1 and offset -273.15" in caplog.text
#     assert "STYLES: contour" in caplog.text

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
@patch('mapgen.modules.helpers._find_summary_from_csw')
def test_read_dataset_request_getmap_vector_barbs(mock_csw, mock_read_config, tmpdir, caplog):
    """Test reading the dataset"""
    netcdf_path = "tests/data/test_arome_arctic.nc"
    query_string = ("?&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=wind_10m_vector&WIDTH=767&HEIGHT=880&CRS=EPSG%3A3857&"
                    "BBOX=-4891698.287598623,6944679.416003374,10026224.553483257,24060418.79038676&STYLES=Wind_Barbs&"
                    "FORMAT=image/png&TRANSPARENT=TRUE&&TIME=2024-11-11T07%3A00%3A00Z&DIM_SPACING=32&DIM_COLOUR=light-green")
    http_host = "localhost"
    url_scheme = "http"
    mock_csw.return_value = "TEST CSW"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
                                 'base_netcdf_directory': '.',
                                 'module': 'mapgen.modules.arome_arctic_quicklook',
                                 'module_function': 'arome_arctic_quicklook',
                                 'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                 'map_file_bucket': 'test-map-bucket',
                                 'geotiff_bucket': 'test_bucket',
                                 'mapfiles_path': tmpdir,
                                 'geotiff_tmp': tmpdir,
                                 'default_dataset': 'presure'}, None, None, None

    caplog.set_level(logging.DEBUG)
    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '200 OK'
    assert 'Selected style: Wind_Barbs' in caplog.text
    assert 'VECTOR wind_10m_vector x_wind_10m y_wind_10m' in caplog.text

@patch('mapgen.modules.get_quicklook.find_config_for_this_netcdf')
@patch('mapgen.modules.helpers._find_summary_from_csw')
def test_read_dataset_request_getmap_vector_vector(mock_csw, mock_read_config, tmpdir, caplog):
    """Test reading the dataset"""
    netcdf_path = "tests/data/test_arome_arctic.nc"
    query_string = ("?&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=wind_10m_vector&WIDTH=767&HEIGHT=880&CRS=EPSG%3A3857&"
                    "BBOX=-4891698.287598623,6944679.416003374,10026224.553483257,24060418.79038676&STYLES=vector&"
                    "FORMAT=image/png&TRANSPARENT=TRUE&&TIME=2024-11-11T07%3A00%3A00Z&DIM_SPACING=32&DIM_COLOUR=light-green")
    http_host = "localhost"
    url_scheme = "http"
    mock_csw.return_value = "TEST CSW"
    mock_read_config.return_value =  {'pattern': '^(.*data/test_arome_arctic.nc)$',
                                 'base_netcdf_directory': '.',
                                 'module': 'mapgen.modules.arome_arctic_quicklook',
                                 'module_function': 'arome_arctic_quicklook',
                                 'mapfile_template': os.path.join(tmpdir, 'test.map'),
                                 'map_file_bucket': 'test-map-bucket',
                                 'geotiff_bucket': 'test_bucket',
                                 'mapfiles_path': tmpdir,
                                 'geotiff_tmp': tmpdir,
                                 'default_dataset': 'presure'}, None, None, None

    caplog.set_level(logging.DEBUG)
    response_code, result, content_type = get_quicklook(netcdf_path, query_string, http_host, url_scheme, products=[])
    assert response_code == '200 OK'
    assert 'Selected style: vector' in caplog.text
    assert 'VECTOR wind_10m_vector x_wind_10m y_wind_10m' in caplog.text

if __name__ == '__main__':
    #_create_arome_arctic_dataset_from_orig_data()
    _create_arome_arctic_dataset_from_orig_data_without_reference_time()
